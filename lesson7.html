<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <style>
      * {
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="stats"></div>
    <div id="three"></div>
    <script src="./three.js"></script>
    <script src="./SceneUtils.js"></script>
    <script>
      //设置场景
      const scene = new THREE.Scene();
      //设置相机，这里是设置透视相机，参数分别为（视角，宽高比例，近聚点，远聚点）
      let camera = new THREE.PerspectiveCamera(
        45,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
      );
      //设置相机的位置
      camera.position.x = -30;
      camera.position.y = 40;
      camera.position.z = 30;
      //让相机指向场景的中央
      camera.lookAt(scene.position);

      //设置绘制对象，基于webGL的渲染器，还有基于canvas和svg等等
      const renderer = new THREE.WebGLRenderer();
      renderer.setClearColor(new THREE.Color(0xeeeeee, 1.0));
      renderer.setSize(window.innerWidth, window.innerHeight);

      //设置平面
      //设置平面宽高和平面的宽高段数，宽高段数可以使平面更加精细，具体怎么调不清楚
      const planeGeometry = new THREE.PlaneGeometry(70, 50, 1, 1);
      //设置平面材质，这里只设置了颜色
      const planeMeterial = new THREE.MeshLambertMaterial({ color: 0xcccccc });
      //创建平面
      const plane = new THREE.Mesh(planeGeometry, planeMeterial);

      //设置平面的旋转角度和定位
      plane.rotation.x = -0.5 * Math.PI;
      plane.position.x = 0;
      plane.position.y = 0;
      plane.position.z = 0;
      //打开地面阴影
      plane.receiveShadow = true;
      //添加平面
      scene.add(plane);

      //光源，这里使用环境光
      const ambientLight = new THREE.AmbientLight(0x0c0c0c);
      scene.add(ambientLight);

      //光源，这里是点光源
      const spotLight = new THREE.SpotLight(0xffffff);
      //设置点光源的位置
      spotLight.position.set(-40, 60, -10);
      //设置光源可以生产阴影
      spotLight.castShadow = true;
      //把点光源增加到场景中
      scene.add(spotLight);
      //增加雾化效果(颜色，近距离，远距离)
      scene.fog = new THREE.Fog(0xffffff, 0.0005, 100);

      //方块铺满平面
      //设定方块的骨架
      const cubeGeometry = new THREE.BoxGeometry(4, 4, 4);
      //通过for循环设定方块的位置和颜色
      for (let j = 0; j < planeGeometry.parameters.height / 5; j++) {
        for (let i = 0; i < planeGeometry.parameters.width / 5; i++) {
          //随机红色
          const red = Math.random() * 0.75 + 0.25;
          //设置立方体材质
          const cubeMaterial = new THREE.MeshLambertMaterial({
            color: new THREE.Color(red, 0, 0)
          });
          const cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
          cube.position.x = -(planeGeometry.parameters.width / 2) + 2 + i * 5;
          cube.position.y = 2;
          cube.position.z = -(planeGeometry.parameters.height / 2) + 2 + j * 5;
          scene.add(cube);
        }
      }

      //控制器，用来切换相机
      const switchCamera = () => {
          //通过判断相机类型来切换相机
        if (camera instanceof THREE.PerspectiveCamera) {
          camera = new THREE.OrthographicCamera(
            window.innerWidth / -16,
            window.innerWidth / 16,
            window.innerHeight / -16,
            window.innerHeight / 16,
            -200,
            500
          );
          camera.position.x = -30;
          camera.position.y = 40;
          camera.position.z = 30;
          //让相机指向场景的中央
          camera.lookAt(scene.position);
          render();
        } else {
          camera = new THREE.PerspectiveCamera(
            45,
            window.innerWidth / window.innerHeight,
            0.1,
            1000
          );
          //设置相机的位置
          camera.position.x = -30;
          camera.position.y = 40;
          camera.position.z = 30;
          //让相机指向场景的中央
          camera.lookAt(scene.position);
          render();
        }
      };

      setInterval(function() {
        switchCamera();
      }, 2000);

      const render = () => {
        renderer.render(scene, camera);
      };
      //通过左右方向键来控制相机y轴旋转
      document.onkeydown = event => {
        switch (event.keyCode) {
          case 37:
            camera.rotation.y += 0.02;
            render();
            break;
          case 39:
            camera.rotation.y -= 0.02;
            render();
            break;
        }
      };

      render();

      //将renderer的输出挂在到元素中
      document.getElementById("three").appendChild(renderer.domElement);
    </script>
  </body>
</html>
